---
import type { Course } from '../lib/supabase';

interface Props {
	course: Course;
}

const { course } = Astro.props;
const college = course.colleges;
const category = course.course_categories;
---

<article class="course-card" data-course-id={course.id}>
	<div class="card-image">
		<img
			src={course.image_url || 'https://images.pexels.com/photos/267885/pexels-photo-267885.jpeg?auto=compress&cs=tinysrgb&w=800'}
			alt={course.title}
			loading="lazy"
		/>
		{course.featured && (
			<span class="featured-badge">Featured</span>
		)}
		{course.price === 'Free' ? (
			<span class="price-badge free">Free</span>
		) : (
			<span class="price-badge">{course.price}</span>
		)}
	</div>

	<div class="card-content">
		<div class="card-header">
			{college && (
				<div class="college-info">
					{college.logo_url && (
						<img
							src={college.logo_url}
							alt={college.name}
							class="college-logo"
							loading="lazy"
						/>
					)}
					<span class="college-name">{college.name}</span>
				</div>
			)}
			{category && (
				<span class="category-badge">{category.icon} {category.name}</span>
			)}
		</div>

		<h3 class="course-title">
			<a href={course.course_url || '#'} target="_blank" rel="noopener noreferrer">
				{course.title}
			</a>
		</h3>

		<p class="course-description">
			{course.short_description || course.description.slice(0, 120) + '...'}
		</p>

		{college && (
			<div class="ratings-section">
				<div class="rating-item">
					<span class="rating-label">Popularity</span>
					<div class="rating-bar">
						<div class="rating-fill" style={`width: ${Math.min((college.popularity_score || 0) / 10, 100)}%`}></div>
					</div>
					<span class="rating-score">{college.popularity_score || 0}/100</span>
				</div>
				<div class="rating-item">
					<span class="rating-label">Ease of Access</span>
					<div class="rating-stars">
						{Array.from({ length: 5 }, (_, i) => (
							<svg width="14" height="14" viewBox="0 0 14 14" fill={i < (college.ease_of_access_score || 0) ? "currentColor" : "none"} class={i < (college.ease_of_access_score || 0) ? "star-filled" : "star-empty"}>
								<path d="M7 1L8.545 5.13L13 5.545L9.727 8.455L10.636 13L7 10.545L3.364 13L4.273 8.455L1 5.545L5.455 5.13L7 1Z" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						))}
					</div>
				</div>
				<div class="rating-item">
					<span class="rating-label">Accreditation</span>
					<span class="accreditation-badge">{college.accreditation_level || 'Regional'}</span>
				</div>
			</div>
		)}

		<div class="card-meta">
			<div class="meta-item">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
					<path d="M8 4V8L10.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				<span>{course.duration}</span>
			</div>

			<div class="meta-item">
				<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
					<path d="M2 5.33333L8 2L14 5.33333L8 8.66667L2 5.33333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
					<path d="M2 10.6667L8 14L14 10.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
					<path d="M2 8L8 11.3333L14 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
				<span>{course.level}</span>
			</div>

			{course.certificate_available && (
				<div class="meta-item">
					<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
						<path d="M6 8L7.5 9.5L10 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
					<span>Certificate</span>
				</div>
			)}
		</div>

		<a href={college?.website_url || course.course_url || '#'} target="_blank" rel="noopener noreferrer" class="view-program-btn">
			View Program
			<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
				<path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
		</a>
	</div>
</article>

<style>
	.course-card {
		background: white;
		border-radius: calc(var(--border-radius) * 1.25);
		overflow: hidden;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		display: flex;
		flex-direction: column;
		height: 100%;
		border: 1px solid var(--neutral-100);
	}

	.course-card:hover {
		box-shadow: 0 12px 32px rgba(30, 64, 175, 0.15);
		transform: translateY(-8px);
		border-color: var(--color-primary-light);
	}

	.card-image {
		position: relative;
		height: 200px;
		overflow: hidden;
		background: var(--neutral-200);
	}

	.card-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: var(--transition);
	}

	.course-card:hover .card-image img {
		transform: scale(1.05);
	}

	.featured-badge {
		position: absolute;
		top: calc(var(--spacing) * 2);
		left: calc(var(--spacing) * 2);
		padding: calc(var(--spacing) * 0.75) calc(var(--spacing) * 2);
		background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
		color: white;
		font-size: 0.75rem;
		font-weight: 700;
		border-radius: calc(var(--border-radius) * 0.5);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
	}

	.price-badge {
		position: absolute;
		top: calc(var(--spacing) * 2);
		right: calc(var(--spacing) * 2);
		padding: calc(var(--spacing) * 0.75) calc(var(--spacing) * 2);
		background: rgba(15, 23, 42, 0.85);
		color: white;
		font-size: 0.875rem;
		font-weight: 700;
		border-radius: calc(var(--border-radius) * 0.5);
		backdrop-filter: blur(12px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
	}

	.price-badge.free {
		background: linear-gradient(135deg, #10b981 0%, #059669 100%);
		box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
	}

	.card-content {
		padding: calc(var(--spacing) * 3);
		display: flex;
		flex-direction: column;
		flex: 1;
	}

	.card-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: calc(var(--spacing) * 2);
		gap: calc(var(--spacing) * 1);
		flex-wrap: wrap;
	}

	.college-info {
		display: flex;
		align-items: center;
		gap: calc(var(--spacing) * 1);
		flex: 1;
		min-width: 0;
	}

	.college-logo {
		width: 24px;
		height: 24px;
		border-radius: 4px;
		object-fit: contain;
	}

	.college-name {
		font-size: 0.875rem;
		color: var(--neutral-600);
		font-weight: 500;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.category-badge {
		padding: calc(var(--spacing) * 0.5) calc(var(--spacing) * 1.5);
		background: var(--neutral-100);
		color: var(--neutral-700);
		font-size: 0.75rem;
		font-weight: 600;
		border-radius: calc(var(--border-radius) / 2);
	}

	.course-title {
		font-size: 1.25rem;
		font-weight: 700;
		margin-bottom: calc(var(--spacing) * 1.5);
		line-height: 1.3;
	}

	.course-title a {
		color: var(--neutral-900);
		text-decoration: none;
		transition: var(--transition);
	}

	.course-title a:hover {
		color: var(--color-primary);
	}

	.course-description {
		font-size: 0.9375rem;
		color: var(--neutral-600);
		line-height: 1.6;
		margin-bottom: calc(var(--spacing) * 2);
		flex: 1;
	}

	.card-meta {
		display: flex;
		align-items: center;
		gap: calc(var(--spacing) * 2);
		flex-wrap: wrap;
		padding-top: calc(var(--spacing) * 2);
		border-top: 1px solid var(--neutral-200);
	}

	.meta-item {
		display: flex;
		align-items: center;
		gap: calc(var(--spacing) * 0.75);
		color: var(--neutral-600);
		font-size: 0.875rem;
	}

	.meta-item svg {
		color: var(--neutral-400);
	}

	.ratings-section {
		background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
		padding: calc(var(--spacing) * 2.5);
		border-radius: calc(var(--border-radius) * 0.75);
		margin-bottom: calc(var(--spacing) * 2);
		border: 1px solid var(--neutral-200);
	}

	.rating-item {
		display: flex;
		align-items: center;
		gap: calc(var(--spacing) * 1.5);
		margin-bottom: calc(var(--spacing) * 1.5);
	}

	.rating-item:last-child {
		margin-bottom: 0;
	}

	.rating-label {
		font-size: 0.8125rem;
		color: var(--neutral-600);
		font-weight: 500;
		min-width: 90px;
	}

	.rating-bar {
		flex: 1;
		height: 6px;
		background: var(--neutral-200);
		border-radius: 3px;
		overflow: hidden;
	}

	.rating-fill {
		height: 100%;
		background: linear-gradient(90deg, #1e40af 0%, #06b6d4 100%);
		transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
		border-radius: 3px;
	}

	.rating-score {
		font-size: 0.8125rem;
		color: var(--neutral-700);
		font-weight: 600;
		min-width: 50px;
		text-align: right;
	}

	.rating-stars {
		display: flex;
		gap: calc(var(--spacing) * 0.5);
	}

	.star-filled {
		color: #f59e0b;
	}

	.star-empty {
		color: var(--neutral-300);
	}

	.accreditation-badge {
		padding: calc(var(--spacing) * 0.5) calc(var(--spacing) * 1.5);
		background: white;
		color: var(--color-primary);
		font-size: 0.75rem;
		font-weight: 600;
		border-radius: calc(var(--border-radius) / 2);
		border: 1.5px solid var(--color-primary);
	}

	.view-program-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: calc(var(--spacing) * 1);
		width: 100%;
		padding: calc(var(--spacing) * 2);
		background: linear-gradient(135deg, #1e40af 0%, #0ea5e9 100%);
		color: white;
		font-size: 0.9375rem;
		font-weight: 700;
		border-radius: calc(var(--border-radius) * 0.75);
		text-decoration: none;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		margin-top: calc(var(--spacing) * 2);
		box-shadow: 0 2px 8px rgba(30, 64, 175, 0.2);
	}

	.view-program-btn:hover {
		background: linear-gradient(135deg, #1e3a8a 0%, #0284c7 100%);
		transform: translateY(-2px);
		box-shadow: 0 4px 16px rgba(30, 64, 175, 0.3);
	}

	.view-program-btn svg {
		transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.view-program-btn:hover svg {
		transform: translateX(4px);
	}

	@media (max-width: 768px) {
		.card-image {
			height: 180px;
		}

		.course-title {
			font-size: 1.125rem;
		}
	}
</style>
